<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <title>📅 جدولي الدراسي</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#5b86e5">
  <style>
    body {
      font-family: "Cairo", Tahoma, sans-serif;
      background: linear-gradient(135deg, #36d1dc, #5b86e5);
      margin: 0;
      padding: 20px;
      color: #fff;
      text-align: center;
      transition: background 1s ease; /* انتقال للخلفية */
    }
    h1 {
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.15);
      padding: 10px 20px;
      border-radius: 12px;
      border: 2px solid rgba(255, 255, 255, 0.4);
      display: inline-block;
    }
    #dayTitle {
      font-size: 1.5em;
      margin-bottom: 15px;
      text-shadow: 1px 1px 3px #00000055;
    }
    #scheduleContainer {
      opacity: 0;
      transform: translateY(20px);
      transition: all 0.6s ease;
    }
    #scheduleContainer.show {
      opacity: 1;
      transform: translateY(0);
    }
    table {
      width: 95%;
      max-width: 700px;
      margin: auto;
      border-collapse: collapse;
      background: #fff;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
      color: #333;
      border-radius: 15px;
      overflow: hidden;
    }
    thead {
      background: #5b86e5;
      color: white;
      font-size: 1.2em;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 16px;
      text-align: center;
      font-size: 1.1em;
    }
    td input {
      width: 100%;
      padding: 10px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1.05em;
      text-align: center;
      direction: rtl;
      background: #f9f9f9;
      transition: all 0.3s ease;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.08);
      box-sizing: border-box;
    }
    td input:focus {
      outline: none;
      border-color: #5b86e5;
      background: #fff;
      box-shadow: 0 0 6px rgba(91,134,229,0.6);
    }
    .holiday {
      font-size: 1.6em;
      font-weight: bold;
      padding: 30px 20px;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.2);
      display: inline-block;
      margin-top: 20px;
      color: #2e7d32;
    }
    .separator {
      background: #f1f1f1;
      font-weight: bold;
      font-size: 1.1em;
      text-align: center;
      border-top: 3px solid #333;
      border-bottom: 3px solid #333;
      color: #444;
    }
  </style>
</head>
<body>
  <h1>📅 جدولي الدراسي</h1>
  <div id="dayTitle"></div>
  <div id="scheduleContainer"></div>

<script>
const days = ["الأحد","الإثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت"];
let currentDayIndex = new Date().getDay();

const morningSlots = ["08:00 - 09:00","09:00 - 10:00","10:00 - 11:00","11:00 - 12:00"];
const eveningSlots = ["13:30 - 14:30","14:30 - 15:30","15:30 - 16:30","16:30 - 17:30"];
const container = document.getElementById("scheduleContainer");
const dayTitle = document.getElementById("dayTitle");

function updateBackground(dayIdx){
  if(dayIdx === 5 || dayIdx === 6){
    document.body.style.background = "#d32f2f"; // خلفية حمراء كاملة
  } else {
    document.body.style.background = "linear-gradient(135deg, #36d1dc, #5b86e5)";
  }
}

function buildDay(dayIdx){
  container.classList.remove("show"); // اخفاء قبل التغيير
  setTimeout(() => {
    container.innerHTML = "";
    const dayName = days[dayIdx];
    dayTitle.textContent = `اليوم: ${dayName}`;

    // تغيير الخلفية
    updateBackground(dayIdx);

    // الجمعة أو السبت = عطلة
    if(dayIdx === 5 || dayIdx === 6){
      container.innerHTML = `<div class="holiday">🌴 إجازة</div>`;
      container.classList.add("show");
      return;
    }

    const table = document.createElement("table");
    let thead = `<thead><tr><th>الوقت</th><th>المادة</th></tr></thead>`;
    let tbody = "<tbody>";

    // --- صباح ---
    morningSlots.forEach((time, i) => {
      const key = `${dayName}_m${i}`;
      const saved = localStorage.getItem(key) || "";
      tbody += `<tr>
        <td>${time}</td>
        <td><input type="text" value="${saved}" oninput="localStorage.setItem('${key}', this.value)" /></td>
      </tr>`;
    });

    // فاصل
    tbody += `<tr><td colspan="2" class="separator">الفترة المسائية</td></tr>`;

    // --- مساء ---
    if(dayIdx === 2){ // الثلاثاء مساء إجازة
      tbody += `<tr><td colspan="2" style="color:#2e7d32; font-weight:bold;">🌿 إجازة</td></tr>`;
    } else {
      eveningSlots.forEach((time, i) => {
        const key = `${dayName}_e${i}`;
        const saved = localStorage.getItem(key) || "";
        tbody += `<tr>
          <td>${time}</td>
          <td><input type="text" value="${saved}" oninput="localStorage.setItem('${key}', this.value)" /></td>
        </tr>`;
      });
    }

    tbody += "</tbody>";
    table.innerHTML = thead + tbody;
    container.appendChild(table);

    setTimeout(() => container.classList.add("show"), 50); // إظهار بالأنيميشن
  }, 300);
}

// السحب للتنقل بين الأيام
let touchStartX = 0;
document.addEventListener("touchstart", e => {
  touchStartX = e.changedTouches[0].screenX;
});
document.addEventListener("touchend", e => {
  let touchEndX = e.changedTouches[0].screenX;
  if(touchEndX - touchStartX > 50){
    currentDayIndex = (currentDayIndex+6)%7;
    buildDay(currentDayIndex);
  } else if(touchStartX - touchEndX > 50){
    currentDayIndex = (currentDayIndex+1)%7;
    buildDay(currentDayIndex);
  }
});

// تحديث تلقائي بعد منتصف الليل
function checkNewDay(){
  const now = new Date();
  const storedDay = localStorage.getItem("lastDay");
  if(storedDay != now.getDate()){
    localStorage.setItem("lastDay", now.getDate());
    currentDayIndex = now.getDay();
    buildDay(currentDayIndex);
  }
}
setInterval(checkNewDay, 60000);

localStorage.setItem("lastDay", new Date().getDate());
buildDay(currentDayIndex);

// تسجيل service worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('service-worker.js')
    .catch(err => console.log('Service Worker failed:', err));
}
</script>
</body>
</html>